P8105 Homework 5
================
Kyung Suk Lee
2020-11-10

  - [Problem 1](#problem-1)
      - [1-1) Description of the raw data](#description-of-the-raw-data)
      - [1-2) Create a city\_state variable and obtain the total number
        of homicides and the number of unsolved
        homicides](#create-a-city_state-variable-and-obtain-the-total-number-of-homicides-and-the-number-of-unsolved-homicides)
      - [1-3) Estimate the proportion of homicides that are
        unsolved](#estimate-the-proportion-of-homicides-that-are-unsolved)
      - [Problem 2](#problem-2)

``` r
library(tidyverse)
library(rvest)

knitr::opts_chunk$set(
  fig.width = 6,
  fig.asp = .6,
  out.width = "90%")

theme_set(theme_minimal() + theme(legend.position = "bottom"))
options(
  ggplot2.continuous.colour = "viridis",
  ggplot2.continuous.fill = "viridis")

scale_colour_discrete = scale_color_viridis_d
scale_fill_discrete = scale_fill_viridis_d

knitr::opts_chunk$set(comment = NA, message = FALSE, warning = FALSE, echo = TRUE)
```

# Problem 1

## 1-1) Description of the raw data

``` r
homicide_raw =
  read_csv("homicide_data/homicide-data.csv")
homicide_raw
```

    # A tibble: 52,179 x 12
       uid   reported_date victim_last victim_first victim_race victim_age
       <chr>         <dbl> <chr>       <chr>        <chr>       <chr>     
     1 Alb-~      20100504 GARCIA      JUAN         Hispanic    78        
     2 Alb-~      20100216 MONTOYA     CAMERON      Hispanic    17        
     3 Alb-~      20100601 SATTERFIELD VIVIANA      White       15        
     4 Alb-~      20100101 MENDIOLA    CARLOS       Hispanic    32        
     5 Alb-~      20100102 MULA        VIVIAN       White       72        
     6 Alb-~      20100126 BOOK        GERALDINE    White       91        
     7 Alb-~      20100127 MALDONADO   DAVID        Hispanic    52        
     8 Alb-~      20100127 MALDONADO   CONNIE       Hispanic    52        
     9 Alb-~      20100130 MARTIN-LEY~ GUSTAVO      White       56        
    10 Alb-~      20100210 HERRERA     ISRAEL       Hispanic    43        
    # ... with 52,169 more rows, and 6 more variables: victim_sex <chr>,
    #   city <chr>, state <chr>, lat <dbl>, lon <dbl>, disposition <chr>

  - Some comments on raw data: This dataset is collected by The
    Washington Post by gathering data on more than 52,000 criminal
    homicides over the past decade in 50 of the largest American cities.
    The dataset is comprised of **52179** observations (rows) and **12**
    columns. The variables include *uid, reported\_date, victim\_last,
    victim\_first, victim\_race, victim\_age, victim\_sex, city, state,
    lat, lon, disposition*. Some of the important variables in this
    dataset are location of the killing, whether an arrest was made and,
    basic demographic information (e.g., sex, age, race) about each
    victim.

## 1-2) Create a city\_state variable and obtain the total number of homicides and the number of unsolved homicides

``` r
homicide_df = 
  homicide_raw %>% 
  janitor::clean_names() %>% 
  mutate(
    city_state = str_c(city, state, sep = "_"),
    resolved = case_when(
      disposition == "Closed without arrest" ~ "unsolved",
      disposition == "Open/No arrest"        ~ "unsolved",
      disposition == "Closed by arrest"      ~ "solved"
    )
  ) %>% 
  select(city_state, resolved) %>% 
  filter(city_state != "Tulsa_AL")

aggregate_df = 
  homicide_df %>% 
    group_by(city_state) %>% 
    summarize(
      hom_total = n(),
      hom_unsolved = sum(resolved == "unsolved")
      )

aggregate_df
```

    # A tibble: 50 x 3
       city_state     hom_total hom_unsolved
       <chr>              <int>        <int>
     1 Albuquerque_NM       378          146
     2 Atlanta_GA           973          373
     3 Baltimore_MD        2827         1825
     4 Baton Rouge_LA       424          196
     5 Birmingham_AL        800          347
     6 Boston_MA            614          310
     7 Buffalo_NY           521          319
     8 Charlotte_NC         687          206
     9 Chicago_IL          5535         4073
    10 Cincinnati_OH        694          309
    # ... with 40 more rows

## 1-3) Estimate the proportion of homicides that are unsolved

``` r
# pull the estimated proportion and confidence intervals

prop.test(
  aggregate_df %>% filter(city_state == "Baltimore_MD") %>% pull(hom_unsolved),
  aggregate_df %>% filter(city_state == "Baltimore_MD") %>% pull(hom_total)
  ) %>% 
  broom::tidy() %>% 
  select(estimate, conf.low, conf.high)
```

    # A tibble: 1 x 3
      estimate conf.low conf.high
         <dbl>    <dbl>     <dbl>
    1    0.646    0.628     0.663

Letâ€™s iterate

``` r
results_df = 
  aggregate_df %>% 
    mutate(
      prop_tests = map2(.x = hom_unsolved, .y = hom_total, ~prop.test(x = .x, n = .y)),
      tidy_tests = map(.x = prop_tests, ~broom::tidy(.x))
    ) %>% 
    select(-prop_tests) %>% 
    unnest(tidy_tests) %>% 
    select(city_state, estimate, conf.low, conf.high)
```

``` r
results_df %>%
  mutate(city_state = fct_reorder(city_state, estimate)) %>% 
  ggplot(aes(x = city_state, y = estimate)) +
  geom_point() +
  geom_errorbar(aes(ymin = conf.low, ymax = conf.high)) +
  theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust = 1))
```

<img src="p8105_hw5_kl3069_files/figure-gfm/unnamed-chunk-5-1.png" width="90%" />

``` r
city_prop_test = function(df){ 
  
  n_unsolved ...
  n_total ...
  
  prop.test(...)
  
}

homicide_df = 
  read_csv("data/homicide-data.csv") %>% 
  mutate(
    city_state = str_c(city, state, sep = "_"),
    resolved = case_when(
      disposition == "Closed without arrest" ~ "unsolved",
      disposition == "Open/No arrest"        ~ "unsolved",
      disposition == "Closed by arrest"      ~ "solved"
    )
  ) %>% 
  select(city_state, resolved) %>% 
  filter(city_state != "Tulsa_AL") %>% 
  nest()
```

## Problem 2

``` r
data_1 = read_csv("arm_data/con_01.csv")

path_df = 
  tibble(
    path = list.files("lda_data")
  ) %>% 
  mutate(path = str_c("lda_data", path),
         data = map(...)
         )

read_csv(path_df$path[[1]])
```
